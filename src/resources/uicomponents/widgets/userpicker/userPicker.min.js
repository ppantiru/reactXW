'use strict';var XWiki=function defineUserPicker(c,f){var g=c.widgets;if(!g||!g.SuggestPicker)return f=f||0,5<f?console.error("Failed to define the UserPicker module: required dependency SuggestPicker is missing."):setTimeout(defineUserPicker.bind(window,c,f+1),0),c;var l=Class.create(g.SuggestPicker,{matchesSelectedValue:function(a,b){return c.Model.resolve(a,c.EntityType.DOCUMENT).name==b.id},getDefaultSuggestion:function(a){var b=c.Model.resolve(a,c.EntityType.DOCUMENT);return{id:b.name,value:a,
info:b.name,icon:"$xwiki.getSkinFile('icons/xwiki/noavatar.png')"}},acceptSuggestion:function(a){this.list.down('input[value="'+a.value+'"]')||this.addItem(a);this.input.value=""},addItem:function($super,b){this.input.hasClassName("multipleSelection")||this.list.update("");$super(b)},displayItem:function(a){var b=this.suggest.createItemDisplay(a,{});b.down(".user-name").insert(this.createDeleteTool());return(new Element("li")).insert(b).insert(this.createItemInput(a))},createItemInput:function(a){return new Element("input",
{type:"hidden",name:this.inputName,value:a.value})}});g.UserPicker=Class.create(g.Suggest,{initialize:function($super,b,e){$super(b,Object.extend({varname:"input",enableHideButton:!1,timeout:3E4},e||{}));var d=b;b.hasClassName("withScope")&&!b.hasClassName("global")&&(this._sourceURL=e.script,this._createScope(),d=b.up());this._selectionManager=this._createSelectionManager({listInsertionElement:d,listInsertionPosition:"before",acceptFreeText:!0});this.multipleSelection=b.hasClassName("multipleSelection");
""!=b.id&&(g.UserPicker.instances[b.id]=this)},createItemDisplay:function(a,b){var e=new Element("div",{"class":"user"}),d=new Element("div",{"class":"user-avatar-wrapper"});d.insert(new Element("img",{src:a.icon,alt:a.info,"class":"icon"}));e.insert(d);d=b.highlight?this.emphasizeMatches(this.sInput.escapeHTML(),a.info.escapeHTML()):a.info.escapeHTML();e.insert((new Element("div",{"class":"user-name"})).update(d));d=new Element("div");b=b.highlight?this.emphasizeMatches(this.sInput.escapeHTML(),
a.id.escapeHTML()):a.id.escapeHTML();d.insert((new Element("span",{"class":"user-alias"})).update(b));a=c.Model.resolve(a.value,c.EntityType.DOCUMENT).extractReferenceValue(c.EntityType.WIKI)||c.currentWiki;"$xcontext.mainWikiName"!==a&&d.insert((new Element("span",{"class":"user-wiki"})).update(a.escapeHTML()));e.insert(d);return e},clear:function(){this.fld.clear();this._selectionManager.clearAcceptedList()},_createSelectionManager:function(a){return new l(this.fld,this,a)},_createScope:function(){this._scope=
new Element("input",{type:"image","class":"scope",alt:"$services.localization.render('core.widgets.userPicker.scopeHint')",title:"$services.localization.render('core.widgets.userPicker.scopeHint')"});var a=(new Element("span")).insert(this._scope);this.fld.insert({before:a});a.insert(this.fld);this._scope.observe("click",this._toggleScope.bindAsEventListener(this));this._toggleScope()},_toggleScope:function(a){a&&a.stop();"local"==this._scope.value?(this._scope.value="global",this._scope.src="$xwiki.getSkinFile('icons/silk/world.png')"):
(this._scope.value="local",this._scope.src="$xwiki.getSkinFile('icons/silk/world_delete.png')");this.sources[0].script=this._sourceURL+"wiki="+this._scope.value+"&"},detach:function($super){this._selectionManager&&this._selectionManager.detach();this._scope&&this._scope.stopObserving("click").up().insert({before:this.fld}).remove();$super()}});g.UserPicker.instances={};f=function(a){var b={users:{script:c.currentDocument.getURL("get","xpage=uorgsuggest&uorg=user&"),noresults:"$services.localization.render('core.widgets.userPicker.noResults')"},
groups:{script:c.currentDocument.getURL("get","xpage=uorgsuggest&uorg=group&"),noresults:"$services.localization.render('core.widgets.groupPicker.noResults')"}},e=a&&a.memo.elements||[$("body")];Object.keys(b).each(function(d){e.each(function(m){m.select("input.suggest"+d.capitalize()).each(function(h){if(!h.hasClassName("initialized")){var k=Object.clone(b[d]);h.hasClassName("global")&&(k.script+="wiki=global&");new g.UserPicker(h,k);h.addClassName("initialized")}})})});return!0};c.domIsLoaded&&
f()||document.observe("xwiki:dom:loaded",f);document.observe("xwiki:dom:updated",f);return c}(XWiki||{});

//# sourceMappingURL=userPicker.min.js.map
