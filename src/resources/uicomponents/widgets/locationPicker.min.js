/*
 #set ($paths = {
  'treeRequireConfig': $services.webjars.url('org.xwiki.platform:xwiki-platform-tree-webjar', 'require-config.min.js',
    {'evaluate': true, 'minify': $services.debug.minify})
})
#set ($l10nKeys = [
  'entitynamevalidation.nametransformation.error',
  'core.validation.valid.message',
  'core.validation.required.message',
  'core.validation.required.message.terminal'
])
#set ($l10n = {})
#foreach ($key in $l10nKeys)
  #set ($discard = $l10n.put($key, $services.localization.render($key)))
#end
#[[*/
'use strict';(function(B,x){require([B.treeRequireConfig],function(){require(["tree"],function(f){f(".location-picker").each(function(){var r=f(this),p=r.find(".location-action-pick"),m=r.find(".modal"),q=m.find(".location-tree"),e=m.find(".modal-footer .btn-primary");p.click(function(c){c.preventDefault();m.modal()});m.on("shown.bs.modal",function(c){var n=p.attr("data-openTo");n&&n!==m.data("openTo")?m.data("openTo",n):n=!1;c=f.jstree.reference(q);c?n&&(c.deselect_all(),c.close_all(),c.openTo(n)):
c=q.xtree({core:{multiple:"true"===q.data("multiple")}}).one("ready.jstree",function(a,b){n&&b.instance.openTo(n)}).on("changed.jstree",function(a,b){e.prop("disabled",0===b.selected.size())}).on("dblclick",".jstree-anchor",function(){e.click()})});e.click(function(){m.modal("hide");m.triggerHandler("xwiki:locationTreePicker:select",{tree:f.jstree.reference(q)})})})})});require(["jquery","xwiki-meta"],function(f,r){f(".location-picker").each(function(){var p=f(this),m=p.find(".location-wiki-field"),
q=p.find("input.location-parent-field");p.find(".location-action-pick").click(function(e){if(e=q.val()){var c=m.val()||r.wiki;e=XWiki.Model.resolve(e,XWiki.EntityType.SPACE,[c]);e=new XWiki.EntityReference("WebHome",XWiki.EntityType.DOCUMENT,e);e="document:"+XWiki.Model.serialize(e);f(this).attr("data-openTo",e)}});p.find(".modal").on("xwiki:locationTreePicker:select",function(e,c){c=c.tree.get_selected()[0];var n=c.indexOf(":");e=c.substr(0,n);c=c.substr(n+1);c=XWiki.Model.resolve(c,XWiki.EntityType.byName(e));
e=c.extractReference(XWiki.EntityType.WIKI);m.val(e?e.name:"");e=(c=c.extractReference(XWiki.EntityType.SPACE))?XWiki.Model.serialize(c.relativeTo(e)):"";q.val(e);q.triggerHandler("input")})})});require(["jquery","xwiki-meta","xwiki-events-bridge"],function(f,r){f(".location-picker").each(function(){var p=f(this),m=p.closest("form"),q=m.find("input[type=submit]:not([disabled=disabled]),input[type=button]:not([disabled=disabled]),button:not([disabled=disabled])"),e=m.find("a.button:not(.disabled)"),
c=p.find("input.location-title-field"),n=p.find(".location-wiki-field"),a=p.find("input.location-parent-field"),b=p.find("input.location-name-field"),d=p.find(".breadcrumb"),g,k=function(l){var h=XWiki.currentDocument.getURL("get");return f.get(h,{xpage:"entitynamevalidation_json",outputSyntax:"plain",name:l,form_token:r.form_token})},t=function(l){var h=d.children(".preview");0===h.length&&(h=f(document.createElement("li")).addClass("preview active").appendTo(d));h.text(l)},v=function(){q.prop("disabled",
!1);e.removeClass("disabled")},y,z=function(){q.prop("disabled",!0);e.addClass("disabled");var l=c.val();k(l).done(function(h){l===c.val()&&(b.val(h.transformedName).trigger("change"),t(c.val()));v()}).fail(function(h){l===c.val()&&(new XWiki.widgets.Notification(x["entitynamevalidation.nametransformation.error"],"error"),b.val(l).trigger("change"),t(c.val()));v()})};m=function(l,h){var w=h?h.value:a.val();clearTimeout(g);g=setTimeout(function(){A(n.val(),w)},500)};var A=function(l,h){l=l||n.val();
h=h||a.val();var w=XWiki.Model.resolve(h||r.space,XWiki.EntityType.SPACE),C=new XWiki.EntityReference("WebHome",XWiki.EntityType.DOCUMENT,w);l&&w.appendParent(new XWiki.WikiReference(l));f.post(D(),{xpage:"hierarchy_reference",reference:XWiki.Model.serialize(C)},function(u){u=f(u);d.replaceWith(u);d=u;h||d.find("li").not(".wiki").remove();d.find(".active").removeClass("active");u=c.val();t(u?u:b.val())})},D=function(){var l=XWiki.Model.resolve(r.space,XWiki.EntityType.SPACE).getReversedReferenceChain().map(function(w){return encodeURIComponent(w.name)}).join("/"),
h=XWiki.Document.URLTemplate;h=h.replace("__space__",l);h=h.replace("__page__",r.page);return h=h.replace("__action__","get")};c.on("input change",function(l){clearTimeout(y);"input"===l.type?y=setTimeout(z,500):z()});n.change(function(l){A(n.val())});b.on("input change",function(l){c.val()||t(b.val())});a.on("input change xwiki:suggest:selected",m);a.val()||m();void 0!==b.val()&&!b.val()&&c.val()?z():t(c.val());var E=p.find(".location-edit");p.find(".location-action-edit").click(function(l){l.preventDefault();
E.toggleClass("hidden")})})});require(["jquery"],function(f){var r=function(a){return 0<a.find(".location-actions").length&&0==a.find(".location-action-edit").length},p=function(a){var b=a.find("input.location-name-field");if(0===b.length)return null;var d=a.find("input.location-title-field");a=0<d.length&&r(a);var g=new LiveValidation(b[0],{validMessage:x["core.validation.valid.message"],insertAfterWhatNode:a?d[0]:b[0]});g.displayMessageWhenEmpty=!0;g.add(Validate.Custom,{failureMessage:x["core.validation.required.message"],
against:function(k){return!b.hasClass("empty")&&"string"===typeof k&&0<k.strip().length}});d.on("input",function(){setTimeout(function(){g.validate()},0)});b.on("change",function(){g.validate()});return g},m=function(a){var b=a.find("input.location-parent-field");if(0<b.length){var d=a.find(".breadcrumb-container");a=0<d.length&&r(a);b=new LiveValidation(b[0],{validMessage:x["core.validation.valid.message"],onlyOnBlur:!0,insertAfterWhatNode:a?d[0]:b[0]});b.displayMessageWhenEmpty=!0;return b}return null},
q=function(a,b,d){a._customValuesParams&&(a.remove(Validate.Custom,a._customValuesParams),delete a._customValuesParams);0<b.length&&(a._customValuesParams={failureMessage:d,against:function(g){for(var k=0;k<b.length;k++){var t=b[k];if(t===g||0===g.indexOf(t+"."))return!0}return!1}},a.add(Validate.Custom,a._customValuesParams))},e=function(a,b){a.add(Validate.Custom,{failureMessage:x["core.validation.required.message.terminal"],against:function(d){return b.prop("checked")?"string"===typeof d&&0<d.strip().length:
!0}});b.change(function(){a.validate()})},c=function(a,b){a.change(function(){a.prop("checked")&&b.prop("checked",!1)});b.change(function(){b.prop("checked")&&a.prop("checked",!1)})},n=[];f(".location-picker").each(function(){var a=f(this),b=[],d=m(a);d&&(b.push(d),a.data("spaceValidator",d));var g=p(a);g&&(b.push(g),a.data("pageValidator",g));n.push.apply(n,b);var k=a.find(".location-edit"),t=a.find(".location-action-edit");a.closest("form").submit(function(v){!LiveValidation.massValidate(b)&&k.hasClass("hidden")&&
t.click()});a.find("input.location-parent-field").on("input",function(){d.validate()})});f("form#create").each(function(){var a=f(this),b=a.find(".location-picker").data("spaceValidator");e(b,a.find("#terminal"));var d=function(k){var t="true"==k.attr("data-restrictions-are-suggestions"),v=[],y=k.attr("data-allowed-spaces");!t&&y&&(v=f.parseJSON(k.attr("data-allowed-spaces")));k=k.attr("data-allowed-spaces-message");q(b,v,k)};a.find(".xwiki-select").on("xwiki:select:updated",function(k){k=f('input[name="type"]:checked');
d(k);b.validate()});var g=a.find('input[name="templateprovider"]');0==g.length&&(g=a.find('.xwiki-select input[name="type"]:checked'));d(g)});f("form#copy, form#rename").each(function(){var a=f(this),b=a.find(".location-picker").data("spaceValidator"),d=a.find('input[name="terminal"]'),g=a.find('input[name="deep"]'),k=a.find('select[name="language"]');e(b,d);c(g,d);k.change(function(){"ALL"===k.val()?g.prop("disabled",!1):g.prop({checked:!1,disabled:!0})})})})}).apply("]]#",$jsontool.serialize([$paths,
$l10n]));

//# sourceMappingURL=locationPicker.min.js.map
