/*
 #set ($currentLocale = $services.localization.getCurrentLocale())
#set ($dateFormatSymbols = $datetool.getDateFormatSymbols($currentLocale))
#set ($calendar = $datetool.toCalendar(0, $currentLocale))
*/
'use strict';var Externals=function(n){"undefined"==typeof Prototype&&alert("CalendarDateSelect depends on Prototype.js which is not available.");"1.6">Prototype.Version&&alert("Prototype 1.6.0 is required. If you're using an earlier version of Prototype.js, please use calendar_date_select version 1.8.3");Element.addMethods({purgeChildren:function(a){$A(a.childNodes).each(function(b){$(b).remove()})},build:function(a,b,c,d){b=Element.buildAndAppend(b,c,d);a.appendChild(b);return b}});Element.buildAndAppend=
function(a,b,c){var d=$(document.createElement(a));$H(b).each(function(e){d[e.key]=e.value});c&&d.setStyle(c);return d};Date.one_day=864E5;Date.first_day_of_week=$mathtool.sub($calendar.getFirstDayOfWeek(),1);var p=$jsontool.serialize($dateFormatSymbols.getWeekdays().subList(1,8));Date.weekdays=[];for(var l=0;7>l;l++)Date.weekdays[l]=p[(l+Date.first_day_of_week)%7].substring(0,3);Date.months=$jsontool.serialize($dateFormatSymbols.getMonths().subList(0,12));Date.padded2=function(a){var b=parseInt(a,
10);10>a&&(b="0"+b);return b};Date.prototype.getPaddedMinutes=function(){return Date.padded2(this.getMinutes())};Date.prototype.getAMPMHour=function(){var a=this.getHours();return 0==a?12:12<a?a-12:a};Date.prototype.getAMPM=function(){return 12>this.getHours()?"AM":"PM"};Date.prototype.stripTime=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate())};Date.prototype.daysDistance=function(a){return Math.round((a-this)/Date.one_day)};var q={format:function(a){return Date.months[a.getMonth()]+
" "+a.getDate()+", "+a.getFullYear()+" "+a.getAMPMHour()+":"+a.getPaddedMinutes()+" "+a.getAMPM()},parse:function(a){return new Date(a)}};Math.floor_to_interval=function(a,b){return Math.floor(a/b)*b};window.f_height=function(){return[window.innerHeight?window.innerHeight:null,document.documentElement?document.documentElement.clientHeight:null,document.body?document.body.clientHeight:null].select(function(a){return 0<a}).first()||0};window.f_scrollTop=function(){return[window.pageYOffset?window.pageYOffset:
null,document.documentElement?document.documentElement.scrollTop:null,document.body?document.body.scrollTop:null].select(function(a){return 0<a}).first()||0};var m={OK:"$escapetool.javascript($services.localization.render('platform.appwithinminutes.classEditorDatePickerAcceptSelectedDate'))",Now:"$escapetool.javascript($services.localization.render('platform.appwithinminutes.classEditorDatePickerSelectCurrentTime'))",Today:"$escapetool.javascript($services.localization.render('platform.appwithinminutes.classEditorDatePickerSelectCurrentDate'))",
Clear:"$escapetool.javascript($services.localization.render('platform.appwithinminutes.classEditorDatePickerClearSelectedDate'))"},k=Class.create();k.prototype={initialize:function(a,b,c,d){this.element=$(a).build("select",c,d);this.populate(b)},populate:function(a){this.element.purgeChildren();var b=this;$A(a).each(function(c){"object"!=typeof c&&(c=[c,c]);b.element.build("option",{value:c[1],innerHTML:c[0]})})},setValue:function(a){var b=this.element,c=!1;$R(0,b.options.length-1).each(function(d){b.options[d].value==
a.toString()&&(b.selectedIndex=d,c=!0)});return c},getValue:function(){return $F(this.element)}};n.CalendarDateSelect=Class.create();n.CalendarDateSelect.prototype={initialize:function(a,b){this.target_element=$(a);if(!this.target_element)return alert("Target element "+a+" not found!"),!1;"INPUT"!=this.target_element.tagName&&(this.target_element=this.target_element.down("INPUT"));this.target_element.calendar_date_select=this;this.last_click_at=0;this.options=$H({embedded:!1,popup:null,time:!1,buttons:!0,
clear_button:!0,year_range:10,close_on_click:null,minute_interval:5,popup_by:this.target_element,month_year:"dropdowns",onchange:function(c){return function(){if(c.dispatchEvent){var d=document.createEvent("HTMLEvents");d.initEvent("change",!0,!0);c.dispatchEvent(d)}else d=document.createEventObject(),d.type="onChange",c.fireEvent("onChange",d)}}(this.target_element),valid_date_check:null,formatter:q}).merge(b||{});this.use_time=this.options.get("time");this.formatter=this.options.get("formatter");
this.parseDate();this.callback("before_show");this.initCalendarDiv();this.options.get("embedded")||(this.positionCalendarDiv(),Event.observe(document,"mousedown",this.closeIfClickedOut_handler=this.closeIfClickedOut.bindAsEventListener(this)),Event.observe(document,"keypress",this.keyPress_handler=this.keyPress.bindAsEventListener(this)));this.callback("after_show")},positionCalendarDiv:function(){var a=!1;this.calendar_div.cumulativeOffset();var b=this.calendar_div.getDimensions().height,c=window.f_scrollTop(),
d=window.f_height(),e=$(this.options.get("popup_by")).cumulativeOffset(),f=e[1];e=e[0];var h=$(this.options.get("popup_by")).getDimensions().height,g=f+h;g+b>c+d&&g-b>c&&(a=!0);a=(a?f-b:f+h).toString()+"px";this.calendar_div.style.left=e.toString()+"px";this.calendar_div.style.top=a;this.calendar_div.setStyle({visibility:""})},initCalendarDiv:function(){if(this.options.get("embedded"))var a=this.target_element.parentNode,b={};else a=document.body,b={position:"absolute",visibility:"hidden",left:0,
top:0};this.calendar_div=$(a).build("div",{className:"calendar_date_select"},b);var c=this;$w("top header body buttons footer bottom").each(function(d){c[d+"_div"]=c.calendar_div.build("div",{className:"cds_"+d},{clear:"left"})});this.initHeaderDiv();this.initButtonsDiv();this.initCalendarGrid();this.updateFooter("&#160;");this.refresh();this.setUseTime(this.use_time)},initHeaderDiv:function(){var a=this.header_div;this.close_button=a.build("a",{innerHTML:"x",href:"#",onclick:function(){this.close();
return!1}.bindAsEventListener(this),className:"close"});this.next_month_button=a.build("a",{innerHTML:"&gt;",href:"#",onclick:function(){this.navMonth(this.date.getMonth()+1);return!1}.bindAsEventListener(this),className:"next"});this.prev_month_button=a.build("a",{innerHTML:"&lt;",href:"#",onclick:function(){this.navMonth(this.date.getMonth()-1);return!1}.bindAsEventListener(this),className:"prev"});"dropdowns"==this.options.get("month_year")?(this.month_select=new k(a,$R(0,11).map(function(b){return[Date.months[b],
b]}),{className:"month",onchange:function(){this.navMonth(this.month_select.getValue())}.bindAsEventListener(this)}),this.year_select=new k(a,[],{className:"year",onchange:function(){this.navYear(this.year_select.getValue())}.bindAsEventListener(this)}),this.populateYearRange()):this.month_year_label=a.build("span")},initCalendarGrid:function(){var a=this.body_div;this.calendar_day_grid=[];a=a.build("table",{cellPadding:"0px",cellSpacing:"0px",width:"100%"});var b=a.build("thead").build("tr");Date.weekdays.each(function(h){b.build("th",
{innerHTML:h})});a=a.build("tbody");for(var c=0,d,e,f=0;42>f;f++)d=(f+Date.first_day_of_week)%7,0==f%7&&(e=a.build("tr",{className:"row_"+c++})),(this.calendar_day_grid[f]=e.build("td",{calendar_date_select:this,onmouseover:function(){this.calendar_date_select.dayHover(this)},onmouseout:function(){this.calendar_date_select.dayHoverOut(this)},onclick:function(){this.calendar_date_select.updateSelectedDate(this,!0)},className:0==d||6==d?" weekend":""},{cursor:"pointer"})).build("div")},initButtonsDiv:function(){var a=
this.buttons_div;if(this.options.get("time")){var b=$A("mixed"==this.options.get("time")?[[" - ",""]]:[]);a.build("span",{innerHTML:"@",className:"at_sign"});var c=new Date;this.hour_select=new k(a,b.concat($R(0,23).map(function(e){c.setHours(e);return $A([c.getAMPMHour()+" "+c.getAMPM(),e])})),{calendar_date_select:this,onchange:function(){this.calendar_date_select.updateSelectedDate({hour:this.value})},className:"hour"});a.build("span",{innerHTML:":",className:"seperator"});var d=this;this.minute_select=
new k(a,b.concat($R(0,59).select(function(e){return 0==e%d.options.get("minute_interval")}).map(function(e){return $A([Date.padded2(e),e])})),{calendar_date_select:this,onchange:function(){this.calendar_date_select.updateSelectedDate({minute:this.value})},className:"minute"})}else this.options.get("buttons")||a.remove();this.options.get("buttons")&&(a.build("span",{innerHTML:"&#160;"}),"mixed"!=this.options.get("time")&&this.options.get("time")||a.build("a",{innerHTML:m.Today,href:"#",onclick:function(){this.today(!1);
return!1}.bindAsEventListener(this)}),"mixed"==this.options.get("time")&&a.build("span",{innerHTML:"&#160;|&#160;",className:"button_seperator"}),this.options.get("time")&&a.build("a",{innerHTML:m.Now,href:"#",onclick:function(){this.today(!0);return!1}.bindAsEventListener(this)}),this.options.get("embedded")||this.closeOnClick()||(a.build("span",{innerHTML:"&#160;|&#160;",className:"button_seperator"}),a.build("a",{innerHTML:m.OK,href:"#",onclick:function(){this.close();return!1}.bindAsEventListener(this)})),
this.options.get("clear_button")&&(a.build("span",{innerHTML:"&#160;|&#160;",className:"button_seperator"}),a.build("a",{innerHTML:m.Clear,href:"#",onclick:function(){this.clearDate();this.options.get("embedded")||this.close();return!1}.bindAsEventListener(this)})))},refresh:function(){this.refreshMonthYear();this.refreshCalendarGrid();this.setSelectedClass();this.updateFooter()},refreshCalendarGrid:function(){this.beginning_date=(new Date(this.date)).stripTime();this.beginning_date.setDate(1);this.beginning_date.setHours(12);
var a=this.beginning_date.getDay();3>a&&(a+=7);this.beginning_date.setDate(1-a+Date.first_day_of_week);a=new Date(this.beginning_date);for(var b=(new Date).stripTime(),c=this.date.getMonth(),d=this.options.get("valid_date_check"),e=0;42>e;e++){var f=a.getDate(),h=a.getMonth(),g=this.calendar_day_grid[e];Element.remove(g.childNodes[0]);var r=g.build("div",{innerHTML:f});h!=c&&(r.className="other");g.day=f;g.month=h;g.year=a.getFullYear();d&&(d(a.stripTime())?g.removeClassName("disabled"):g.addClassName("disabled"));
a.setDate(f+1)}this.today_cell&&this.today_cell.removeClassName("today");$R(0,41).include(a=this.beginning_date.stripTime().daysDistance(b))&&(this.today_cell=this.calendar_day_grid[a],this.today_cell.addClassName("today"))},refreshMonthYear:function(){var a=this.date.getMonth(),b=this.date.getFullYear();"dropdowns"==this.options.get("month_year")?(this.month_select.setValue(a,!1),a=this.year_select.element,this.flexibleYearRange()&&(!this.year_select.setValue(b,!1)||1>=a.selectedIndex||a.selectedIndex>=
a.options.length-2)&&this.populateYearRange(),this.year_select.setValue(b)):this.month_year_label.update().insert(Date.months[a]+" "+b.toString())},populateYearRange:function(){this.year_select.populate(this.yearRange().toArray())},yearRange:function(){if(!this.flexibleYearRange())return $R(this.options.get("year_range")[0],this.options.get("year_range")[1]);var a=this.date.getFullYear();return $R(a-this.options.get("year_range"),a+this.options.get("year_range"))},flexibleYearRange:function(){return"number"==
typeof this.options.get("year_range")},validYear:function(a){return this.flexibleYearRange()?!0:this.yearRange().include(a)},dayHover:function(a){var b=new Date(this.selected_date);b.setFullYear(a.year,a.month,a.day);this.updateFooter(this.formatter.format(b))},dayHoverOut:function(a){this.updateFooter()},clearSelectedClass:function(){this.selected_cell&&this.selected_cell.removeClassName("selected")},setSelectedClass:function(){if(this.selection_made){this.clearSelectedClass();var a;$R(0,42).include(a=
this.beginning_date.stripTime().daysDistance(this.selected_date.stripTime()))&&(this.selected_cell=this.calendar_day_grid[a],this.selected_cell.addClassName("selected"))}},reparse:function(){this.parseDate();this.refresh()},dateString:function(){return this.selection_made?this.formatter.format(this.selected_date):"&#160;"},parseDate:function(){var a=$F(this.target_element).strip(),b=this.options.get("default_time");this.selection_made=""!=a||b;this.date=""==a?NaN:this.formatter.parse(this.options.get("date")||
a);isNaN(this.date)&&!b?this.date=new Date:isNaN(this.date)&&b&&(this.date="[object Function]"===Object.prototype.toString.apply(b)?b():b);this.validYear(this.date.getFullYear())||this.date.setYear(this.date.getFullYear()<this.yearRange().start?this.yearRange().start:this.yearRange().end);this.selected_date=new Date(this.date);this.use_time=/[0-9]:[0-9]{2}/.exec(a)?!0:!1;this.date.setDate(1)},updateFooter:function(a){a||(a=this.dateString());this.footer_div.purgeChildren();this.footer_div.build("span",
{innerHTML:a})},clearDate:function(){if((this.target_element.disabled||this.target_element.readOnly)&&"force"!=this.options.get("popup"))return!1;var a=this.target_element.value;this.target_element.value="";this.clearSelectedClass();this.updateFooter("&#160;");a!=this.target_element.value&&this.callback("onchange")},updateSelectedDate:function(a,b){a=$H(a);if((this.target_element.disabled||this.target_element.readOnly)&&"force"!=this.options.get("popup"))return!1;if(a.get("day")){var c=this.selected_date,
d=this.options.get("valid_date_check");c.setFullYear(a.get("year"),a.get("month"),a.get("day"));if(d&&!d(c.stripTime()))return!1;this.selected_date=c;this.selection_made=!0}isNaN(a.get("hour"))||this.selected_date.setHours(a.get("hour"));isNaN(a.get("minute"))||this.selected_date.setMinutes(Math.floor_to_interval(a.get("minute"),this.options.get("minute_interval")));""===a.get("hour")||""===a.get("minute")?this.setUseTime(!1):isNaN(a.get("hour"))&&isNaN(a.get("minute"))||this.setUseTime(!0);this.updateFooter();
this.setSelectedClass();this.selection_made&&this.updateValue();this.closeOnClick()&&this.close();b&&!this.options.get("embedded")&&(333>new Date-this.last_click_at&&this.close(),this.last_click_at=new Date)},closeOnClick:function(){return this.options.get("embedded")?!1:null===this.options.get("close_on_click")?this.options.get("time")?!1:!0:this.options.get("close_on_click")},navMonth:function(a){var b=new Date(this.date);b.setMonth(a);return this.navTo(b)},navYear:function(a){var b=new Date(this.date);
b.setYear(a);return this.navTo(b)},navTo:function(a){if(!this.validYear(a.getFullYear()))return!1;this.date=a;this.date.setDate(1);this.refresh();this.callback("after_navigate",this.date);return!0},setUseTime:function(a){if((this.use_time=this.options.get("time")&&("mixed"==this.options.get("time")?a:!0))&&this.selected_date){a=Math.floor_to_interval(this.selected_date.getMinutes(),this.options.get("minute_interval"));var b=this.selected_date.getHours();this.hour_select.setValue(b);this.minute_select.setValue(a)}else"mixed"==
this.options.get("time")&&(this.hour_select.setValue(""),this.minute_select.setValue(""))},updateValue:function(){var a=this.target_element.value;this.target_element.value=this.dateString();a!=this.target_element.value&&this.callback("onchange")},today:function(a){var b=new Date;this.date=new Date;b=$H({day:b.getDate(),month:b.getMonth(),year:b.getFullYear(),hour:b.getHours(),minute:b.getMinutes()});a||(b=b.merge({hour:"",minute:""}));this.updateSelectedDate(b,!0);this.refresh()},close:function(){if(this.closed)return!1;
this.callback("before_close");this.target_element.calendar_date_select=null;Event.stopObserving(document,"mousedown",this.closeIfClickedOut_handler);Event.stopObserving(document,"keypress",this.keyPress_handler);this.calendar_div.remove();this.closed=!0;this.iframe&&this.iframe.remove();"hidden"==this.target_element.type||this.target_element.disabled||this.target_element.focus();this.callback("after_close")},closeIfClickedOut:function(a){a=a.element();a==this.target_element||a.descendantOf(this.calendar_div)||
this.close()},keyPress:function(a){a.keyCode==Event.KEY_ESC&&this.close()},callback:function(a,b){this.options.get(a)&&this.options.get(a).bind(this.target_element)(b)}};return n}(Externals||{});

//# sourceMappingURL=calendarDateSelect.min.js.map
