/*
 * PROCOLOR LICENSE
* ----------------
*
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions are met:
*
** Redistributions of source code must retain the above copyright
* notice, this list of conditions and the following disclaimer.
*
** Redistributions in binary form must reproduce the above copyright
* notice, this list of conditions and the following disclaimer in the
* documentation and/or other materials provided with the distribution.
*
* THIS SOFTWARE IS PROVIDED BY THE PHANTOM INKER AND CONTRIBUTORS "AS IS"
* AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
* ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
* LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
* CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
* SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
* INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
* CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
* ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
* THE POSSIBILITY OF SUCH DAMAGE.
*/
'use strict';"undefined"==typeof Prototype&&alert("ProColor Error:  Prototype is not loaded. Please make sure that your page includes prototype.js before it includes procolor.js.");"1.6">Prototype.Version&&alert("ProColor Error:  Minimum Prototype 1.6.0 is required; you are using "+Prototype.Version);
Element.addMethods({build:function(a,b,d,c){var e=$(document.createElement(b));$H(d).each(function(f){e[f.key]=f.value});c&&e.setStyle(c);a.appendChild(e);return e},isEventIn:function(a,b){var d=a.getDimensions();a=a.cumulativeOffset();var c=b.pointerX();b=b.pointerY();return c>=a.left&&b>=a.top&&c<a.left+d.width&&b<a.top+d.height}});
var MouseCapture=Class.create({initialize:function(){},onEvent:function(a,b){b&&"mouseover"!=a.type&&"mouseout"!=a.type&&b(a,a.type);a.stop()},setCursor:function(a){this.div&&this.div.setStyle({cursor:a})},begin:function(a){this.listener=this.onEvent.bindAsEventListener(this,a);Event.observe(document,"mouseup",this.listener);Event.observe(document,"mousemove",this.listener);Event.observe(document,"mousedown",this.listener);Event.observe(document,"mouseover",this.listener);Event.observe(document,"mouseout",
this.listener);Event.observe(document,"keyup",this.listener);Event.observe(document,"keydown",this.listener);this.old_body_ondrag=document.body.ondrag;this.old_body_onselectstart=document.body.onselectstart;document.body.ondrag=function(){return!1};document.body.onselectstart=function(){return!1};a=Element.extend(document.body);var b=a.getDimensions();this.div=a.build("div",{},{display:"block",position:"absolute",top:"0px",left:"0px",width:b.width+"px",height:b.height+"px",zIndex:999999999,cursor:"default",
backgroundColor:"#FFFFFF",opacity:1E-4})},end:function(){this.div.remove();Event.stopObserving(document,"mouseup",this.listener);Event.stopObserving(document,"mousemove",this.listener);Event.stopObserving(document,"mousedown",this.listener);Event.stopObserving(document,"mouseover",this.listener);Event.stopObserving(document,"mouseout",this.listener);Event.stopObserving(document,"keyup",this.listener);Event.stopObserving(document,"keydown",this.listener);document.body.ondrag=this.old_body_ondrag;document.body.onselectstart=
this.old_body_onselectstart;delete this.old_body_ondrag;delete this.old_body_onselectstart}}),ProColor=Class.create({palette:"F00C30900633963C63 FC9FC0C93F93F96F60 993CC3FF0FF6FF9FFC 3306639966939C39C6 0F09C99F9CFCCF69F0 3C36960630933C6396 6999CC9FF0FF6FC3C9 36603303936F69F0CF 00666C00F66F99FCCF C9F90F60C63F30930C 96CC6FC3F90C639306 C9C969C6CF9F909606 F0FF9CC69F39F69F06 F66F99FCC936C36C39".split(" "),options:{imgPath:"#set($imgPath = $xwiki.getSkinFile('uicomponents/widgets/colorpicker/img/procolor_win_bg.png'))#set($imgPath = $imgPath.substring(0, $imgPath.lastIndexOf('bg.png')))${imgPath}",
showInField:!0},initialize:function(a){var b=navigator.appVersion.split("MSIE");b=parseFloat(b[1]);this.old_ie=5.5<=b&&7>b&&document.body.filters;this.color=this.div=null;this.listeners={};this.dblclk={time:0};this.parent=a.parent?$(a.parent):Element.extend(document.body);this.input=a.input?$(a.input):null;this.options={mode:"static",width:360,height:192,offsetx:13,offsety:8,input:null,showInField:!1,parent:null,closeButton:"popup"==a.mode,imgPath:"#set($imgPath = $xwiki.getSkinFile('uicomponents/widgets/colorpicker/img/procolor_win_bg.png'))#set($imgPath = $imgPath.substring(0, $imgPath.lastIndexOf('bg.png')))${imgPath}",
color:this.input?"INPUT"==this.input.tagName?this.input.value:this.input.innerHTML:"#FFFFFF",editbg:"#FFFFFF",edittext:"#4C4C4C",outputFormat:"#{RR}{GG}{BB}",onOpening:null,onOpened:null,onClosing:null,onClosed:null,onCloseButton:null,onChanging:null,onChanged:null,onCancelClick:null,onAcceptClick:null};for(var d in a)this.options[d]=a[d];if(this.options.onOpening)this.options.onOpening(this,"opening");this.createDiv();"popup"==this.options.mode&&(this.positionPopup(),Event.observe(document,"mousedown",
this.closeClickHandler=this.handleCloseClick.bindAsEventListener(this)),Event.observe(document,"keypress",this.keyPressHandler=this.handleKeyPress.bindAsEventListener(this)));if(this.options.onOpened)this.options.onOpened(this,"opened")},positionPopup:function(){this.div.cumulativeOffset();var a=this.div.getDimensions(),b=a.height;a=a.width;var d=document.viewport.getHeight(),c=document.viewport.getWidth(),e=document.viewport.getScrollOffsets(),f=$(this.input).cumulativeOffset(),g=f[1];f=f[0];var h=
$(this.input).getDimensions().height,k=g+h;f+a>c-8&&(f=c-8-a);8>f&&(f=8);b=(k+b>e.top+d&&k-b>e.top?g-b:g+h).toString()+"px";this.div.style.left=f.toString()+"px";this.div.style.top=b;this.div.setStyle({visibility:"",display:"block"})},createDiv:function(){var a={display:"block",width:this.options.width+"px",height:this.options.height+"px",backgroundPosition:"0% 0%",backgroundAttachment:"scroll",backgroundRepeat:"no-repeat",backgroundImage:"url("+this.options.imgPath+(this.old_ie?"bg.gif)":"bg.png)"),
color:"#BBBBD7",left:0,top:0};"popup"==this.options.mode?(a.position="absolute",a.display="none",a.visibility="hidden",a.zIndex=999999):a.position="relative";this.div=$(this.parent).build("div",{className:"procolor_box"},a);this.img_palette=this.loadBgImage(this.div,"palette_raw.png",0,1,66,174);this.img_bar_lower=this.loadBgImage(this.div,"bars.png",77,1,20,174,{zIndex:1,opacity:1});this.img_bar_middle=this.loadBgImage(this.div,"bars.png",77,1,20,174,{zIndex:2,opacity:0});this.img_bar_upper=this.loadBgImage(this.div,
"bars.png",77,1,20,174,{zIndex:3,opacity:0});this.img_wheel_rgb=this.loadBgImage(this.div,"wheel_rgb.jpg",105,0,176,176,{zIndex:1,opacity:1});this.img_wheel_black=this.loadBgImage(this.div,"wheel_black.png",105,0,176,176,{zIndex:2,opacity:1});this.img_boxes=this.loadBgImage(this.div,"boxes.png",287,25,50,149,{zIndex:1});this.img_bar_dragger=this.createImageButton(this.div,"sel_rect",73+this.options.offsetx,-1+this.options.offsety,24,8,{zIndex:4});this.img_wheel_dragger=this.createImageButton(this.div,
"sel_circle",184+this.options.offsetx,79+this.options.offsety,17,17,{zIndex:5});this.listeners.wheel=this.onWheelEvent.bindAsEventListener(this);this.img_wheel_black.observe("mousedown",this.listeners.wheel);this.img_wheel_dragger.observe("mousedown",this.listeners.wheel);this.img_wheel_dragger.observe("keydown",this.listeners.wheel);this.listeners.bar=this.onBarEvent.bindAsEventListener(this);this.img_bar_upper.observe("mousedown",this.listeners.bar);this.img_bar_dragger.observe("mousedown",this.listeners.bar);
this.img_bar_dragger.observe("keydown",this.listeners.bar);this.listeners.palette=this.onPaletteEvent.bindAsEventListener(this);this.img_palette.observe("mousedown",this.listeners.palette);this.wheel={left:106+this.options.offsetx,top:1+this.options.offsety,width:174,height:174};this.bar={left:77+this.options.offsetx,top:2+this.options.offsety,width:20,height:172};this.wheelsel={width:17,height:17};this.barsel={width:24,height:8};this.listeners.rgb=this.onNumberBox.bindAsEventListener(this,"rgb",
0,255,0);this.r_edit=this.createEdit(this.div,287,25,37,20,this.listeners.rgb);this.g_edit=this.createEdit(this.div,287,47,37,20,this.listeners.rgb);this.b_edit=this.createEdit(this.div,287,69,37,20,this.listeners.rgb);this.listeners.hue=this.onNumberBox.bindAsEventListener(this,"hsb",0,359,360);this.listeners.satbrt=this.onNumberBox.bindAsEventListener(this,"hsb",0,100,0);this.hue_edit=this.createEdit(this.div,287,110,37,20,this.listeners.hue);this.sat_edit=this.createEdit(this.div,287,132,37,20,
this.listeners.satbrt);this.brt_edit=this.createEdit(this.div,287,154,37,20,this.listeners.satbrt);this.options.closeButton&&(this.img_close=this.createImageButton(this.div,"close",this.options.width-40,0,24,16),this.listeners.close=this.onCloseEvent.bindAsEventListener(this),this.img_close.observe("mouseover",this.listeners.close),this.img_close.observe("mouseout",this.listeners.close),this.img_close.observe("mousedown",this.listeners.close),this.img_close.observe("keydown",this.listeners.close),
this.img_close.trackingMouse=!1);this.input&&"INPUT"==this.input.tagName?(this.listeners.input=this.onInput.bindAsEventListener(this),this.input.observe("keyup",this.listeners.input),this.input.observe("focus",this.listeners.input),this.input.observe("blur",this.listeners.input)):this.listeners.input=null;(a=this.decodeHexColor(this.options.color))||(a={r:0,g:0,b:0});this.update("rgb",a,[])},loadBgImage:function(a,b,d,c,e,f,g){b={display:"block",position:"absolute",width:e+"px",height:f+"px",left:d+
this.options.offsetx+"px",top:c+this.options.offsety+"px",padding:"0",backgroundImage:"url("+this.options.imgPath+b+")"};if(g)for(var h in g)b[h]=g[h];return a.build("div",{},b)},createImageButton:function(a,b,d,c,e,f,g){b={display:"block",position:"absolute",width:e+"px",height:f+"px",left:d+"px",top:c+"px",border:"0",cursor:"default",padding:"0",fontSize:"1px",backgroundImage:"url("+this.options.imgPath+b+(this.old_ie?".gif)":".png)")};if(g)for(var h in g)b[h]=g[h];return a.build("a",{href:"#"},
b)},createEdit:function(a,b,d,c,e,f){a=a.build("input",{type:"text",value:"0",maxLength:3},{display:"inline",position:"absolute",width:c-9+"px",height:e-6+"px",left:b+5+this.options.offsetx+"px",top:d+2+this.options.offsety+"px",verticalAlign:"top",backgroundColor:this.options.editbg,padding:"0",color:this.options.edittext,fontFamily:"Verdana,Tahoma,Arial,sans-serif,sans serif,sans",fontSize:"12px",fontStyle:"Normal",fontVariant:"Normal",fontWeight:"Normal",textAlign:"right",direction:"ltr",border:0,
zIndex:10});a.observe("keypress",f);a.observe("keyup",f);a.observe("focus",f);a.observe("blur",f);return a},close:function(){if(!this.div)return!1;if(this.options.onClosing)this.options.onClosing(this,"closing");this.options.closeButton&&Event.stopObserving(this.img_close);Event.stopObserving(this.r_edit);Event.stopObserving(this.g_edit);Event.stopObserving(this.b_edit);Event.stopObserving(this.hue_edit);Event.stopObserving(this.sat_edit);Event.stopObserving(this.brt_edit);Event.stopObserving(this.img_wheel_black);
Event.stopObserving(this.img_bar_upper);Event.stopObserving(this.img_palette);Event.stopObserving(this.img_wheel_dragger);Event.stopObserving(this.img_bar_dragger);this.listeners.input&&(Event.stopObserving(this.input,"keyup",this.listeners.input),Event.stopObserving(this.input,"focus",this.listeners.input),Event.stopObserving(this.input,"blur",this.listeners.input));Event.stopObserving(document,"mousedown",this.closeClickHandler);Event.stopObserving(document,"keypress",this.keyPressHandler);this.div.remove();
this.div=null;this.listeners={};this.dblclk={};"hidden"==this.input.type||this.input.disabled||this.input.focus();if(this.options.onClosed)this.options.onClosed(this,"closed")},updateState:{},updateTimeout:!1,queuedUpdate:function(a,b,d){if(Prototype.Browser.IE){var c=this;c.updateState={mode:a,color:b,sources:d};0==c.updateTimeout&&(c.updateTimeout=setTimeout(function(){c.updateTimeout=!1;c.update(c.updateState.mode,c.updateState.color,c.updateState.sources)},25))}else this.update(a,b,d)},finalUpdate:function(){this.updateTimeout&&
(clearTimeout(this.updateTimeout),this.updateTimeout=!1,this.update(this.updateState.mode,this.updateState.color,this.updateState.sources),this.updateState={})},update:function(a,b,d){"object"!=typeof b&&(b={r:0,g:0,b:0,hue:0,sat:0,brt:0});b.r=this.toNumber(b.r);b.g=this.toNumber(b.g);b.b=this.toNumber(b.b);b.hue=this.toNumber(b.hue);b.sat=this.toNumber(b.sat);b.brt=this.toNumber(b.brt);if("rgb"==a){var c=b;var e=this.RGBtoHSB(c)}else"hsb"==a&&(e=b,c=this.HSBtoRGB(e));0>c.r&&(c.r=0);255<c.r&&(c.r=
255);0>c.g&&(c.g=0);255<c.g&&(c.g=255);0>c.b&&(c.b=0);255<c.b&&(c.b=255);e.hue%=360;0>e.hue&&(e.hue+=360);0>e.sat&&(e.sat=0);100<e.sat&&(e.sat=100);0>e.brt&&(e.brt=0);100<e.brt&&(e.brt=100);var f={};d.each(function(g){f[g]=!0});f.wheel||(a=e.brt/100,.9999<a&&(a=.9999),this.img_wheel_black.setOpacity(1-a),a=(e.hue+270)%360*(2*Math.PI/360),this.img_wheel_dragger.setStyle({left:Math.floor(Math.cos(a)*e.sat*this.wheel.width/200+.5)+this.wheel.left+(this.wheel.width-4)/2+2-Math.floor(this.wheelsel.width/
2)+"px",top:Math.floor(Math.sin(a)*e.sat*this.wheel.height/200+.5)+this.wheel.top+(this.wheel.height-4)/2+2-Math.floor(this.wheelsel.height/2)+"px"}));f.bar||(a=Math.floor(e.hue/60),b=(a+1)%6,this.img_bar_lower.setStyle({backgroundPosition:20*-a-20+"px 0px"}),this.img_bar_middle.setStyle({backgroundPosition:20*-b-20+"px 0px"}),this.img_bar_middle.setOpacity((e.hue-60*a)/60),a=(100-e.sat)/100,1E-4>a&&(a=1E-4),this.img_bar_upper.setOpacity(a),this.img_bar_dragger.setStyle({top:this.bar.top-Math.floor(this.barsel.height/
2)+Math.floor((100-e.brt)*this.bar.height/100+.5)+"px",left:this.bar.left+Math.floor(this.bar.width-this.barsel.width)/2+"px"}));c.r=Math.floor(c.r+.5);c.g=Math.floor(c.g+.5);c.b=Math.floor(c.b+.5);e.hue=Math.floor(e.hue+.5);e.sat=Math.floor(e.sat+.5);e.brt=Math.floor(e.brt+.5);e.hue%=360;this.color="#"+(c.r.toColorPart()+c.g.toColorPart()+c.b.toColorPart()).toUpperCase();f.rgb||(this.r_edit.value=c.r,this.g_edit.value=c.g,this.b_edit.value=c.b);f.hsb||(this.hue_edit.value=e.hue,this.sat_edit.value=
e.sat,this.brt_edit.value=e.brt);this.options.input&&(a=$(this.options.input),f.input||(e=this.internalFormatOutput(c,e,this.options.outputFormat),"INPUT"==a.tagName?a.value=e:a.innerHTML=e),this.options.showInField&&(c=this.computeTextColor(c),a.setStyle({backgroundColor:this.color,color:"#"+c.r.toColorPart()+c.g.toColorPart()+c.b.toColorPart()})))},toNumber:function(a){var b;switch(typeof a){case "number":return a;case "string":return(b=/^[^0-9.+-]*([+-]?(?:[0-9]*\.[0-9]+|[0-9]+(?:\.[0-9]*)?))(?:[^0-9]|$)/.exec(a))?
Number(b[1]):0;case "boolean":return a?1:0;case "object":return a?1:0;case "function":return 1;default:case "undefined":return 0}},formatOutput:function(a,b){b||(b="#{RR}{GG}{BB}");(a=this.decodeHexColor(a))||(a={r:0,g:0,b:0});return this.internalFormatOutput(a,this.RGBtoHSB(a),b)},internalFormatOutput:function(a,b,d){var c="";d.match(/(\{\w+\}|[^{]+)/g).each(function(e){switch(e){case "{RR}":e=a.r.toColorPart().toUpperCase();break;case "{GG}":e=a.g.toColorPart().toUpperCase();break;case "{BB}":e=
a.b.toColorPart().toUpperCase();break;case "{rr}":e=a.r.toColorPart().toLowerCase();break;case "{gg}":e=a.g.toColorPart().toLowerCase();break;case "{bb}":e=a.b.toColorPart().toLowerCase();break;case "{R}":e=this.halfColorPart(a.r).toUpperCase();break;case "{G}":e=this.halfColorPart(a.g).toUpperCase();break;case "{B}":e=this.halfColorPart(a.b).toUpperCase();break;case "{r}":e=this.halfColorPart(a.r).toLowerCase();break;case "{g}":e=this.halfColorPart(a.g).toLowerCase();break;case "{b}":e=this.halfColorPart(a.b).toLowerCase();
break;case "{red}":e=a.r.toString();break;case "{grn}":e=a.g.toString();break;case "{blu}":e=a.b.toString();break;case "{hue}":e=b.hue.toString();break;case "{sat}":e=b.sat.toString();break;case "{brt}":e=b.brt.toString()}c+=e});return c},halfColorPart:function(a){return Math.floor((a+8)/17).toString(16)},decodeHexColor:function(a){var b;if(b=/^[^0-9A-Fa-f]*([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{0,2})(?:[^0-9A-Fa-f]|$)/.exec(a))return{r:parseInt(b[1],16),g:parseInt(b[2],16),
b:parseInt(b[3],16)};if(b=/^[^0-9A-Fa-f]*([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f])(?:[^0-9A-Fa-f]|$)/.exec(a))return a=parseInt(b[3],16),{r:parseInt(b[1],16),g:parseInt(b[2],16),b:16*a+a};if(b=/^[^0-9A-Fa-f]*([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})(?:[^0-9A-Fa-f]|$)/.exec(a)){var d=parseInt(b[2],16);return{r:parseInt(b[1],16),g:d,b:d}}if(b=/^[^0-9A-Fa-f]*([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f]{0,2})(?:[^0-9A-Fa-f]|$)/.exec(a)){var c=parseInt(b[1],16);d=parseInt(b[2],16);a=parseInt(b[3],16);
return{r:16*c+c,g:16*d+d,b:16*a+a}}return(b=/^[^0-9A-Fa-f]*([0-9A-Fa-f]{2})(?:[^0-9A-Fa-f]|$)/.exec(a))?(d=parseInt(b[1],16),{r:d,g:d,b:d}):(b=/^[^0-9A-Fa-f]*([0-9A-Fa-f])(?:[^0-9A-Fa-f]|$)/.exec(a))?(d=parseInt(b[1],16),d=16*d+d,{r:d,g:d,b:d}):!1},trueBrightness:function(a){return a.r/255*.3+a.g/255*.59+a.b/255*.11},computeTextColor:function(a){var b=this.trueBrightness(a);if(.5>b){b=Math.floor(20*b)+3;var d=255*(b-1)}else b=Math.floor(20*(1-b))+3,d=0;return{r:Math.floor((a.r+d)/b),g:Math.floor((a.g+
d)/b),b:Math.floor((a.b+d)/b)}},RGBtoHSB:function(a){var b=Math.floor(this.toNumber(a.r)+.5),d=Math.floor(this.toNumber(a.g)+.5),c=Math.floor(this.toNumber(a.b)+.5);0>b&&(b=0);255<b&&(b=255);0>d&&(d=0);255<d&&(d=255);0>c&&(c=0);255<c&&(c=255);var e;if(b>d){if(b>c){a=e=b;var f=0;var g=d-c}else a=e=c,f=240,g=b-d;b=e-(d<c?d:c)}else d>c?(a=e=d,f=120,g=c-b):(a=e=c,f=240,g=b-d),b=e-(b<c?b:c);d=0!=e?Math.floor(100*b/e+.5):0;0!=d?(g=(f+Math.floor(120*g/(2*b)+.5))%360,0>g&&(g+=360)):g=0;a=Math.floor(100*a/
255+.5);return{hue:g,sat:d,brt:a}},HSBtoRGB:function(a){var b=this.toNumber(a.brt);0>b&&(b=0);100<b&&(b=100);b=255*b/100;var d=this.toNumber(a.sat);if(0>=d)return b=Math.floor(b+.5),{r:b,g:b,b:b};100<d&&(d=100);a=this.toNumber(a.hue);a%=360;0>a&&(a+=360);d=b*d/100;var c=256*a/60%256*d/256;switch(Math.floor(a/60)){case 0:var e=b;var f=b-d+c;var g=b-d;break;case 1:e=b-c;f=b;g=b-d;break;case 2:e=b-d;f=b;g=b-d+c;break;case 3:e=b-d;f=b-c;g=b;break;case 4:e=b-d+c;f=b-d;g=b;break;case 5:e=b,f=b-d,g=b-c}e=
Math.floor(e+.5);f=Math.floor(f+.5);g=Math.floor(g+.5);0>e&&(e=0);255<e&&(e=255);0>f&&(f=0);255<f&&(f=255);0>g&&(g=0);255<g&&(g=255);return{r:e,g:f,b:g}},acceptAndClose:function(){if(this.options.onAcceptClick)this.options.onAcceptClick(this,"acceptclick");"popup"==this.options.mode&&this.close()},cancelAndClose:function(){if(this.options.onCancelClick)this.options.onCancelClick(this,"cancelclick");"popup"==this.options.mode&&this.close()},closeOnDoubleClick:function(a){var b=a.pointerX();a=a.pointerY();
var d=(new Date).getTime();if(3>Math.abs(this.dblclk.x-b)&&3>Math.abs(this.dblclk.y-a)&&500>=d-this.dblclk.time)return this.dblclk.time=0,this.acceptAndClose(),!0;this.dblclk.x=b;this.dblclk.y=a;this.dblclk.time=d;return!1},brtFromPoint:function(a,b){a=this.img_bar_upper.getDimensions();var d=this.img_bar_upper.cumulativeOffset();return b<d.top?100:b>=d.top+a.height?0:100*(d.top+a.height-1-b)/a.height},hueSatFromPoint:function(a,b){var d=this.img_wheel_rgb.getDimensions(),c=this.img_wheel_rgb.cumulativeOffset();
b=(b-(c.top+d.height/2))/((d.height-4)/2);d=(a-(c.left+d.width/2))/((d.width-4)/2);a=100*Math.sqrt(b*b+d*d)+.5;b=180*Math.atan2(b,d)/Math.PI+90;0>=a&&(b=a=0);100<a&&(a=100);0>b&&(b+=360);return{sat:a,hue:b}},colorFromPalette:function(a,b){var d=this.img_palette.getDimensions();var c=this.img_palette.cumulativeOffset();if(a<c.left||a>=c.left+d.width)return!1;a=Math.floor((a-c.left)/11);if(b>=c.top&&b<c.top+12)c="000333666999CCCFFF";else if(b>c.top+20&&b<c.top+20+11*this.palette.length)c=this.palette[Math.floor((b-
(c.top+20))/11)];else return!1;b=parseInt(c.substr(3*a,1),16);d=parseInt(c.substr(3*a+1,1),16);a=parseInt(c.substr(3*a+2,1),16);return{r:16*b+b,g:16*d+d,b:16*a+a}},updateByMode:function(a){this.update(a,{r:this.r_edit.value,g:this.g_edit.value,b:this.b_edit.value,hue:this.hue_edit.value,sat:this.sat_edit.value,brt:this.brt_edit.value},[a])},onCloseEvent:function(a){switch(a.type){case "keydown":switch(a.keyCode){case Event.KEY_RETURN:case 32:this.options.onCloseButton&&!this.options.onCloseButton(this,
"closebutton")||"popup"!=this.options.mode||this.close()}break;case "mouseover":this.img_close.trackingMouse||this.img_close.setStyle({backgroundPosition:"0px -16px"});break;case "mouseout":this.img_close.trackingMouse||this.img_close.setStyle({backgroundPosition:"0px 0px"});break;case "mousedown":this.img_close.trackingMouse=!0;this.img_close.setStyle({backgroundPosition:"0px -32px"});a.stop();this.img_close.focus&&this.img_close.focus();var b=!0,d=new MouseCapture;d.setCursor("default");d.begin(function(c,
e){switch(e){case "mouseup":case "keyup":d.end();this.img_close.trackingMouse=!1;b?(this.img_close.setStyle({backgroundPosition:"0px -16px"}),this.options.onCloseButton&&!this.options.onCloseButton(this,"closebutton")||"popup"!=this.options.mode||this.close()):this.img_close.setStyle({backgroundPosition:"0px 0px"});break;case "mousemove":b="0px -32px"==this.img_close.getStyle("backgroundPosition"),this.img_close.isEventIn(c)!=b&&((b=!b)?this.img_close.setStyle({backgroundPosition:"0px -32px"}):this.img_close.setStyle({backgroundPosition:"0px 0px"}))}}.bind(this))}},
onBarEvent:function(a){switch(a.type){case "keydown":var b=this,d=this.toNumber(b.brt_edit.value),c=d,e=a.shiftKey||a.ctrlKey||a.altKey;switch(a.keyCode){case Event.KEY_UP:d+=e?10:1;a.stop();break;case Event.KEY_DOWN:d-=e?10:1;a.stop();break;case Event.KEY_PAGEUP:d+=e?25:10;a.stop();break;case Event.KEY_PAGEDOWN:d-=e?25:10;a.stop();break;case Event.KEY_HOME:d=100;a.stop();break;case Event.KEY_END:d=0,a.stop()}0>d&&(d=0);100<d&&(d=100);if(b.options.onChanging&&c!=d)b.options.onChanging(b,"changing");
b.update("hsb",{hue:b.hue_edit.value,sat:b.sat_edit.value,brt:d},[]);if(b.options.onChanged&&c!=d)b.options.onChanged(b,"changed");break;case "mousedown":a.stop();b=this;b.oldcolor=b.color;b.img_bar_dragger.focus&&b.img_bar_dragger.focus();var f=function(h){h={hue:b.hue_edit.value,sat:b.sat_edit.value,brt:b.brtFromPoint(h.pointerX(),h.pointerY())};b.queuedUpdate("hsb",h,[]);if(b.options.onChanging)b.options.onChanging(b,"changing")};f(a);if(!this.closeOnDoubleClick(a)){var g=new MouseCapture;g.setCursor("default");
g.begin(function(h,k){switch(k){case "mouseup":case "keyup":g.end();b.finalUpdate();if(b.options.onChanged&&b.oldcolor!=b.color)b.options.onChanged(b,"changed");break;case "mousemove":f(h)}})}}},onWheelEvent:function(a){switch(a.type){case "keydown":var b=this,d=this.toNumber(b.hue_edit.value),c=d,e=this.toNumber(b.sat_edit.value),f=e,g=a.shiftKey||a.ctrlKey||a.altKey;switch(a.keyCode){case Event.KEY_UP:e+=g?10:1;a.stop();break;case Event.KEY_DOWN:e-=g?10:1;a.stop();break;case Event.KEY_LEFT:d-=g?
10:1;a.stop();break;case Event.KEY_RIGHT:d+=g?10:1;a.stop();break;case Event.KEY_PAGEUP:e+=g?25:10;a.stop();break;case Event.KEY_PAGEDOWN:e-=g?25:10;a.stop();break;case Event.KEY_HOME:e=100;a.stop();break;case Event.KEY_END:e=0,a.stop()}0>e&&(e=0);100<e&&(e=100);d%=360;0>d&&(d+=360);if(b.options.onChanging&&(c!=d||f!=e))b.options.onChanging(b,"changing");b.update("hsb",{hue:d,sat:e,brt:b.brt_edit.value},[]);if(b.options.onChanged&&(c!=d||f!=e))b.options.onChanged(b,"changed");break;case "mousedown":a.stop();
b=this;b.oldcolor=b.color;b.img_wheel_dragger.focus&&b.img_wheel_dragger.focus();var h=function(l){l=b.hueSatFromPoint(l.pointerX(),l.pointerY());l.brt=b.brt_edit.value;b.queuedUpdate("hsb",l,[]);if(b.options.onChanging)b.options.onChanging(b,"changing")};h(a);if(!this.closeOnDoubleClick(a)){var k=new MouseCapture;k.setCursor("default");k.begin(function(l,m){switch(m){case "mouseup":case "keyup":k.end();b.finalUpdate();if(b.options.onChanged&&b.oldcolor!=b.color)b.options.onChanged(b,"changed");break;
case "mousemove":h(l)}})}}},onPaletteEvent:function(a){switch(a.type){case "mousedown":var b=this;b.oldcolor=b.color;b.img_palette.focus&&b.img_palette.focus();var d=function(e){(e=b.colorFromPalette(e.pointerX(),e.pointerY()))&&b.queuedUpdate("rgb",e,[]);if(b.options.onChanging)b.options.onChanging(b,"changing");return e};if(d(a)&&(a.stop(),!this.closeOnDoubleClick(a))){var c=new MouseCapture;c.setCursor("default");c.begin(function(e,f){switch(f){case "mouseup":case "keyup":c.end();b.finalUpdate();
if(b.options.onChanged&&b.oldcolor!=b.color)b.options.onChanged(b,"changed");break;case "mousemove":d(e)}})}}},onNumberBox:function(a,b,d,c,e){var f=Event.element(a);switch(a.type){case "keypress":!a||a.ctrlKey||a.altKey?a.stop():48<=a.charCode&&57>=a.charCode||48<=a.keyCode&&57>=a.keyCode||0<a.keyCode&&48>a.keyCode||a.stop();break;case "keyup":if(a.keyCode!=Event.KEY_TAB&&(this.updateByMode(b),this.options.onChanging))this.options.onChanging(this,"changing");a.keyCode==Event.KEY_RETURN&&(this.acceptAndClose(),
a.stop());a.keyCode==Event.KEY_ESC&&(this.cancelAndClose(),a.stop());break;case "focus":this.oldcolor=this.color;break;case "blur":a=this.toNumber(f.value);if(a<d||a>c)e?(a%=e,0>a&&(a+=e)):a=a<d?d:c,f.value=a,this.updateByMode(b);if(this.options.onChanged&&this.oldcolor!=this.color)this.options.onChanged(this,"changed")}},onInput:function(a){switch(a.type){case "keyup":if(a.keyCode!=Event.KEY_TAB&&(this.update("rgb",this.decodeHexColor(this.input.value),["input"]),this.options.onChanging))this.options.onChanging(this,
"changing");a.keyCode==Event.KEY_RETURN&&(this.acceptAndClose(),a.stop());a.keyCode==Event.KEY_ESC&&(this.cancelAndClose(),a.stop());break;case "focus":this.oldcolor=this.color;break;case "blur":if(a=this.decodeHexColor(this.input.value),this.update("rgb",a,[]),this.oldcolor!=this.color&&(this.input.value=this.internalFormatOutput(a,this.RGBtoHSB(a),this.options.outputFormat),this.options.onChanged))this.options.onChanged(this,"changed")}},handleCloseClick:function(a){a=$(Event.element(a));a==this.div||
a.descendantOf(this.div)||a==this.input||a.descendantOf(this.input)||this.cancelAndClose()},handleKeyPress:function(a){a.keyCode==Event.KEY_ESC&&this.cancelAndClose()},attachButton:function(a,b){if(a=$(a)){var d=b.imgPath?b.imgPath:"";var c=$(document.createElement("a"));c.setStyle({display:"inline-block",visibility:"visible",border:"0px",textDecoration:"none",verticalAlign:"bottom",width:"40px",height:"24px",padding:"0px",marginLeft:"2px",backgroundImage:"url("+d+"drop.png)",backgroundPosition:"0px 0px",
backgroundRepeat:"no-repeat",cursor:"default"});c.href="#";for(var e in this.buttonMembers)c[e]=this.buttonMembers[e];d=b.color;c.buttonHandler=c.eventHandler.bindAsEventListener(c);c.options=Object.clone(b);c.options.input=a;c.options.pc=this;delete c.options.color;c.options.outputFormat||(c.options.outputFormat="#{RR}{GG}{BB}");Event.observe(c,"click",c.buttonHandler);Event.observe(c,"mouseover",c.buttonHandler);Event.observe(c,"mouseout",c.buttonHandler);Event.observe(c,"mousedown",c.buttonHandler);
Event.observe(c,"mouseup",c.buttonHandler);Event.observe(c,"keydown",c.buttonHandler);Event.observe(c,"keyup",c.buttonHandler);a.nextSibling?a.parentNode.insertBefore(c,a.nextSibling):a.parentNode.appendChild(c);c.inputHandler=c.onInput.bindAsEventListener(c);c.observeInput();d&&(a.value=d);c.colorSync(!0);return c}},buttonMembers:{pressed:!1,hovered:!1,inputHandler:!1,options:{},setImg:function(a){this.setStyle({backgroundPosition:"0px "+-24*a+"px"})},observeInput:function(){Event.observe(this.options.input,
"keyup",this.inputHandler);Event.observe(this.options.input,"focus",this.inputHandler);Event.observe(this.options.input,"blur",this.inputHandler)},stopObservingInput:function(){Event.stopObserving(this.options.input,"keyup",this.inputHandler);Event.stopObserving(this.options.input,"focus",this.inputHandler);Event.stopObserving(this.options.input,"blur",this.inputHandler)},toggle:function(){if(this.pressed)this.setImg(this.hovered?1:0),this.pressed=!1,this.popup&&(this.popup.close(),this.popup=null),
this.observeInput();else{var a=this;this.setImg(2);this.pressed=!0;this.stopObservingInput();this.popup=new ProColor(Object.extend(Object.clone(this.options),{mode:"popup",closeButton:!0,onClosed:function(b,d){a.popup=null;a.setImg(this.hovered?1:0);a.pressed=!1;a.observeInput();if(a.options.onClosed)a.options.onClosed(b,d)},parent:null}))}},colorSync:function(a){var b=this.options.pc.decodeHexColor(this.options.input.value);if(b){if(this.options.showInField){var d=this.options.pc.computeTextColor(b);
this.options.input.setStyle({backgroundColor:"#"+b.r.toColorPart()+b.g.toColorPart()+b.b.toColorPart(),color:"#"+d.r.toColorPart()+d.g.toColorPart()+d.b.toColorPart()})}b=this.options.pc.internalFormatOutput(b,this.options.pc.RGBtoHSB(b),this.options.outputFormat);if(b!=this.options.input.value&&this.options.onChanging)this.options.onChanging(this.options.input,"changing");if(a&&b!=this.options.input.value&&(this.options.input.value=b,this.options.onChanged))this.options.onChanged(this.options.input,
"changed")}},onInput:function(a){switch(a.type){case "keyup":a.keyCode!=Event.KEY_TAB&&this.options.showInField&&this.colorSync(!1);break;case "focus":case "blur":this.colorSync(!0)}},eventHandler:function(a){switch(a.type){case "click":a.stop();break;case "keydown":switch(a.keyCode){case Event.KEY_RETURN:case 32:this.toggle(),a.stop()}break;case "mousedown":this.focus();var b=this;setTimeout(function(){b.toggle()},20);break;case "mouseover":this.pressed?this.setImg(2):this.setImg(1);this.hovered=
!0;break;case "mouseout":this.pressed?this.setImg(2):this.setImg(0),this.hovered=!1}}}});Event.observe(window,"load",function(){$$("input.procolor").each(function(a){ProColor.prototype.attachButton(a,ProColor.prototype.options)})});

//# sourceMappingURL=procolor.min.js.map
