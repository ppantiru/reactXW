'use strict';var XWiki=function(d){function v(a,b,c){for(var e=-1;++e<a.length;)for(var f=0;f<b.length;f++){a:{var g=a;for(var r=e,m=b[f],n=0;n<m.length;n++){var p=r+n;if(p>=g.length||g.charAt(p)!=m.charAt(n)){g=!1;break a}}g=!0}if(g){a=a.substr(0,e)+c[f]+a.substr(e+b[f].length);e+=c[f].length-1;break}}return a}var k=0;d.EntityType={WIKI:k++,SPACE:k++,DOCUMENT:k++,ATTACHMENT:k++,OBJECT:k++,OBJECT_PROPERTY:k++,CLASS_PROPERTY:k++};var t=[],u;for(u in d.EntityType)if(d.EntityType.hasOwnProperty(u)){k=
d.EntityType[u];for(var q=u.toLowerCase().split("_"),l=1;l<q.length;l++)q[l]=q[l].substr(0,1).toUpperCase()+q[l].substr(1);t[k]=q.join("")}d.EntityType.getName=function(a){return t[a]};d.EntityType.byName=function(a){a=a.toLowerCase();for(var b=0;b<t.length;b++)if(t[b]===a)return b;return-1};d.EntityReference=Class.create({initialize:function(a,b,c,e){this.name=a;this.type=b;this.parent=c;this.locale=e},extractReference:function(a){for(var b=this;b&&b.type!=a;)b=b.parent;return b},extractReferenceValue:function(a){return(a=
this.extractReference(a))?a.name:null},relativeTo:function(a){var b=this.getReversedReferenceChain();a=a?a.getReversedReferenceChain():[];for(var c,e=c=0;c<b.length&&e<a.length&&b[c].type!=a[e].type;)b[c].type>a[e].type?e++:c++;for(;c<b.length&&e<a.length&&b[c].type===a[e].type&&b[c].name===a[e].name;)c++,e++;if(e<a.length&&0<e&&a[e].type===a[e-1].type&&0<c)for(c--;0<c&&b[c].type===b[c-1].type;c--);for(var f;c<b.length;c++)f=new d.EntityReference(b[c].name,b[c].type,f);return f||new d.EntityReference("",
this.type)},getReversedReferenceChain:function(){for(var a=[],b=this;b;)a.push(b),b=b.parent;return a.reverse()},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},appendParent:function(a){this.getRoot().parent=a;return this},hasParent:function(a){var b=this.parent;if(b==a)return!0;for(;b&&!b.equals(a);)b=b.parent;return null!=b},equals:function(a){return null==a||null==this.parent&&null!=a.parent||null!=this.parent&&null==a.parent?!1:this.name===a.name&&this.type===a.type&&(null==this.parent||
this.parent.equals(a.parent))},toString:function(){return d.Model.serialize(this)},getName:function(){return this.name}});d.EntityReference.fromJSONObject=function(a){var b=null!=a.parent?d.EntityReference.fromJSONObject(a.parent):void 0;return new d.EntityReference(a.name,d.EntityType.byName(a.type),b,a.locale)};d.WikiReference=Class.create(d.EntityReference,{initialize:function($super,b){$super(b,d.EntityType.WIKI)}});d.SpaceReference=Class.create(d.EntityReference,{initialize:function($super,b,
c){b=new d.WikiReference(b);if(Array.isArray(c)&&0<c.length){var e;for(e=0;e<c.length-1;++e)b=new d.EntityReference(c[e],d.EntityType.SPACE,b);$super(c[e],d.EntityType.SPACE,b)}else if("string"===typeof c||"undefined"==typeof c)$super(c,d.EntityType.SPACE,b);else throw"Missing mandatory space name or invalid type for: ["+c+"]";}});d.DocumentReference=Class.create(d.EntityReference,{initialize:function($super,b,c,e){$super(e,d.EntityType.DOCUMENT,new d.SpaceReference(b,c))}});d.AttachmentReference=
Class.create(d.EntityReference,{initialize:function($super,b,c){$super(b,d.EntityType.ATTACHMENT,c)}});d.EntityReferenceTreeNode=Class.create({initialize:function(){this.children={};this.locales={}},_fromJSONObject:function(a){null!=a.reference&&(this.reference=d.EntityReference.fromJSONObject(a.reference));a.children.each(this._childFromJSONObject.bind(this));a.locales.each(this._localeFromJSONObject.bind(this))},_childFromJSONObject:function(a){var b=new d.EntityReferenceTreeNode;b._fromJSONObject(a);
a=this.children[b.reference.name];"undefined"==typeof a&&(a={},this.children[b.reference.name]=a);a[b.reference.type]=b},_localeFromJSONObject:function(a){this.locales[a.locale]=d.EntityReference.fromJSONObject(a)},hasChildren:function(){return 0!==Object.keys(this.children).length},hasLocales:function(){return 0!==Object.keys(this.locales).length},getChildByReference:function(a){if("undefined"==typeof a)return null;var b=this;a=a.getReversedReferenceChain();for(var c=0;c<a.length;c++){var e=a[c];
b=b.children[e.name];if("undefined"==typeof b)return null;b=b[e.type];if("undefined"==typeof b)return null}return b}});d.EntityReferenceTree=Class.create(d.EntityReferenceTreeNode,{});d.EntityReferenceTree.fromJSONObject=function(a){var b=new d.EntityReferenceTree;b._fromJSONObject(a);return b};var x=[[],[".",":","\\"],[".","\\"],["@","\\"],["^","\\"],[".","\\"],["^",".","\\"]],y=[[],["\\.","\\:","\\\\"],["\\.","\\\\"],["\\@","\\\\"],["\\^","\\\\"],["\\.","\\\\"],["\\^","\\.","\\\\"]],w=[[],[".",
":"],[".",":"],["@",".",":"],["^",".",":"],[".","^",".",":"],["^",".",":"]],z=[null,d.EntityType.WIKI,d.EntityType.SPACE,d.EntityType.DOCUMENT,d.EntityType.DOCUMENT,d.EntityType.OBJECT,d.EntityType.DOCUMENT],h=[];for(l=1;l<w.length;l++)h[l]={};h[d.EntityType.SPACE][":"]=d.EntityType.WIKI;h[d.EntityType.SPACE]["."]=d.EntityType.SPACE;h[d.EntityType.DOCUMENT]["."]=d.EntityType.SPACE;h[d.EntityType.ATTACHMENT]["@"]=d.EntityType.DOCUMENT;h[d.EntityType.OBJECT]["^"]=d.EntityType.DOCUMENT;h[d.EntityType.OBJECT_PROPERTY]["."]=
d.EntityType.OBJECT;h[d.EntityType.CLASS_PROPERTY]["^"]=d.EntityType.DOCUMENT;var A=["\\\\","\\"],B=["\\",""];d.EntityReferenceResolver=Class.create({resolve:function(a,b,c){a=(a||"").split("");b=parseInt(b);if(isNaN(b)||0>b||b>=w.length)throw"No parsing definition found for Entity Type ["+b+"]";var e=h[b];if(!e)return this._getEscapedReference(a,b,c);do{for(var f=null,g=a.length;0<=--g;){var r=a[g],m=g-1,n=0>m?0:a[m];if("number"===typeof e[r])if(0===this._getNumberOfCharsBefore("\\",a,m)%2){f=e[r];
break}else a.splice(m,1),--g;else"\\"===n&&(a.splice(m,1),--g)}e=this._getNewReference(g,a,b,c);var p=this._appendNewReference(p,e);b=f?f:z[b];e=h[b]}while(null!=e);c=this._getEscapedReference(a,b,c);return p=this._appendNewReference(p,c)},_getEscapedReference:function(a,b,c){return 0<a.length?(a=v(a.join(""),A,B),new d.EntityReference(a,b)):this._resolveDefaultReference(b,c)},_getNewReference:function(a,b,c,e){a<b.length-1?(e=b.slice(a+1).join(""),c=new d.EntityReference(e,c)):c=this._resolveDefaultReference(c,
e);b.splice(Math.max(a,0),b.length);return c},_resolveDefaultReference:function(a,b){var c;if("object"===typeof b)if(b&&"function"===typeof b.extractReference){b=b.extractReference(a);for(c=[];b&&b.type===a;)c.push(b.name),b=b.parent;c.reverse()}else c=b&&b[a];else"function"===typeof b&&(c=b(a));b=null;if(c&&0<c.length){"string"===typeof c&&(c=[c]);for(var e=0;e<c.length;e++)b=new d.EntityReference(c[e],a,b)}return b},_appendNewReference:function(a,b){return b?a?a.appendParent(b):b:a},_getNumberOfCharsBefore:function(a,
b,c){for(var e=c;0<=e&&b[e]===a;)--e;return c-e}});d.EntityReferenceSerializer=Class.create({serialize:function(a){return a?this.serialize(a.parent)+this._serializeComponent(a):""},_serializeComponent:function(a){var b="",c=x[a.type];a.parent&&(b+=a.parent.type===d.EntityType.WIKI?":":c[0]);return b=0<c.length?b+v(a.name,c,y[a.type]):b+a.name.replace("\\","\\\\")}});var C=new d.EntityReferenceResolver,D=new d.EntityReferenceSerializer;d.Model={serialize:function(a){return D.serialize(a)},resolve:function(a,
b,c){if(void 0==b&&"string"===typeof a){var e=a.indexOf(":");0<e&&(b=d.EntityType.byName(a.substring(0,e)),0<=b&&(a=a.substring(e+1)))}return C.resolve(a,b,c)}};return d}(XWiki||{});

//# sourceMappingURL=entityReference.min.js.map
