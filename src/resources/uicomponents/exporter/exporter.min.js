/*
 #set ($paths = {
  'treeRequireConfig': $services.webjars.url('org.xwiki.platform:xwiki-platform-tree-webjar', 'require-config.min.js',
    {'evaluate': true, 'minify': $services.debug.minify})
})
#set ($l10nKeys = [
  'core.exporter.selectChildren',
  'core.exporter.unselectChildren'
])
#set ($l10n = {})
#foreach ($key in $l10nKeys)
  #set ($discard = $l10n.put($key, $services.localization.render($key)))
#end
#set ($iconNames = ['check', 'shape_square'])
#set ($icons = {})
#foreach ($iconName in $iconNames)
  #set ($discard = $icons.put($iconName, $services.icon.getMetaData($iconName)))
#end
#[[*/
'use strict';(function(x,w,u){define("export-tree",["jquery","tree"],function(d){var n=function(a,b){b.forEach(function(c){var f=a.get_node(c);!a.is_disabled(c)||0<f.children.length?a.select_node(c,!1,!0):a.is_parent(c)&&(f.original.state.undetermined=!0,f.state.undetermined=!0)})},r=function(a,b){b=b||a.get_node(d.jstree.root);b.children.forEach(function(c){a.is_disabled(c)&&a.is_undetermined(c)&&(a.get_node(c).state.selected=!0);a.deselect_node(c)})},t=function(a,b){b.forEach(function(c){if(a.is_disabled(c)&&
a.is_selected(c)){var f=a.trigger;try{a.trigger=function(){};if(!a.is_loaded(c)&&a.is_parent(c)){var h=a.get_node(c);h.original.state.undetermined=!0;h.state.undetermined=!0}a.deselect_node(c)}finally{a.trigger=f}}})},m=function(a,b,c){var f=[],h=[],q="document"===b.data.type&&b.data.id;q&&(a.is_checked(b)?f.push(q):h.push(q));q=b.children.map(function(k){return a.get_node(k)});q.filter(function(k){return"document"===k.data.type}).forEach(function(k){var p=k.data.id;a.is_leaf(k)?a.is_checked(k)?f.push(p):
h.push(p):(p=XWiki.Model.resolve(p,XWiki.EntityType.DOCUMENT),p=XWiki.Model.serialize(new XWiki.EntityReference("%",XWiki.EntityType.DOCUMENT,p.parent)),a.is_checked(k)&&!a.is_loaded(k)?f.push(p):h.push(p))});var v=g(q);!a.is_loaded(b)&&a.is_undetermined(b)||v&&a.is_checked(v)||!v&&a.is_checked(b)?(b=XWiki.Model.resolve(b.data.id,XWiki.EntityType.byName(b.data.type)),b.type===XWiki.EntityType.DOCUMENT?b=b.parent:b.type===XWiki.EntityType.WIKI&&(b=new XWiki.EntityReference("%",XWiki.EntityType.SPACE,
b)),b=new XWiki.EntityReference("%",XWiki.EntityType.DOCUMENT,b),b=XWiki.Model.serialize(b),c[b]=h):f.forEach(function(k){c[k]=[]});q.forEach(function(k){a.is_leaf(k)||!a.is_loaded(k)&&!a.is_undetermined(k)||m(a,k,c)})},g=function(a){for(var b=a.length-1;0<=b;b--){var c=a[b];if("pagination"===c.data.type)return c}},l={getExportPages:function(){var a={};m(this,this.get_node(d.jstree.root),a);return a},hasExportPages:function(){return 0<this.get_checked().length||0<this.get_undetermined().length},isExportingAllPages:function(){for(var a=
this.get_json(null,{flat:!0,no_data:!0,no_state:!0,no_a_attr:!0,no_li_attr:!0}),b=0;b<a.length;b++){var c=a[b].id;if(!this.is_selected(c)&&!this.is_undetermined(c))return!1}return!0}},e={plugins:["checkbox","contextmenu"],checkbox:{cascade:"down+undetermined",three_state:!1},contextmenu:{select_node:!1,items:function(a){var b=d.jstree.reference(a);return{select_children:{label:w["core.exporter.selectChildren"],icon:u.check.cssClass||u.check.url,action:function(){var c=a;c=c||b.get_node(d.jstree.root);
n(b,c.children)},_disabled:!b.is_open(a)},unselect_children:{label:w["core.exporter.unselectChildren"],icon:u.shape_square.cssClass||u.shape_square.url,action:function(){r(b,a)},_disabled:!b.is_open(a)}}}}};d.fn.exportTree=function(a){return this.on("select_node.jstree select_all.jstree",function(b,c){t(c.instance,c.instance.get_selected().slice())}).on("model.jstree",function(b,c){var f=c.instance;c.nodes.forEach(function(h){h=f.get_node(h);h.original.state=h.original.state||{}});f.is_selected(c.parent)?
t(f,c.nodes):f.is_disabled(c.parent)&&f.is_undetermined(c.parent)&&n(f,c.nodes)}).on("click",".jstree-anchor.jstree-disabled",function(b){d(this).jstree("toggle_node",b.target)}).one("ready.jstree",function(b,c){var f=c.instance;d.extend(f,l);f.select_all();d(this).closest(".export-tree-container").find(".export-tree-action.selectAll").click(function(h){h.preventDefault();f.select_all()}).addBack().find(".export-tree-action.selectNone").click(function(h){h.preventDefault();f.deselect_all()})}).xtree(d.extend(!0,
{},e,a))}});define("export-tree-filter",["jquery","bootstrap","export-tree"],function(d){var n=/filters=(\w*)/,r=function(e){return(e=n.exec(e))&&e[1]||""},t=function(e){var a=e.attr("data-url");a=r(a);var b=e.data("exportTreeFilter");b||(b={},e.data("exportTreeFilter",b));e=d.jstree.reference(e);b[a]={children:e.get_json(),data:e.get_node(d.jstree.root).data}},m,g=function(e,a){if(e.id===d.jstree.root){var b=this.get_container();var c=b.attr("data-url");c=r(c);if(b=b.data("exportTreeFilter")[c])return e.data=
b.data,a(b.children)}return m.apply(this,arguments)},l=function(e,a){t(e);var b=e.attr("data-url");b=n.test(b)?b.replace(n,"filters="+encodeURIComponent(a)):b+("&filters="+encodeURIComponent(a));e.attr("data-url",b);var c=d.jstree.reference(e);c.settings.core.data!==g&&(m=c.settings.core.data,c.settings.core.data=g);if(a=!!e.data("exportTreeFilter")[a]){var f=c.settings.checkbox.cascade;c.settings.checkbox.cascade="";e.one("refresh.jstree",function(){c.settings.checkbox.cascade=f})}c.refresh(a)};
d(document).on("click",".export-tree-filter a",function(e){e.preventDefault();var a=d(this).closest("li");a.hasClass("active")||(e=a.closest(".export-tree-filter"),e.find("li.active").removeClass("active"),a.addClass("active"),a=d(this).data("filter")||"",e.find('input[name="filter"]').val(a),e.find(".active-filter-title").text(d(this).find(".export-tree-filter-title").text()),e=e.closest(".export-tree-container").find(".export-tree"),l(e,a))})});require(["jquery",x.treeRequireConfig],function(d){var n=
function(g,l){g=g.getExportPages();for(var e in g)d("<input/>").attr({type:"hidden",name:"pages",value:e}).appendTo(l),d("<input/>").attr({type:"hidden",name:"excludes",value:t(g[e])}).appendTo(l)};d("#targetXWikiVersion").change(function(){d("#targetXWikiVersionSettings fieldset").prop("disabled",!0);d('#targetXWikiVersionSettings fieldset[data-version-range="'+d(this).val()+'"]').prop("disabled",!1)});d(".export-tree").on("ready.jstree, changed.jstree",function(g,l){g=l.instance;d(this).closest("form#export").find('input[type="submit"]').prop("disabled",
!g.hasExportPages())});var r=d('<div class="hidden"/>').insertAfter(".export-tree");d("form#export").submit(function(){var g=d.jstree.reference(d(this).find(".export-tree"));g&&!g.isExportingAllPages()&&n(g,r.empty())});d(".export-tree").on("ready.jstree, changed.jstree",function(g,l){g=l.instance;d(this).closest("#exportModalOtherCollapse").find(".export-buttons a.btn").toggleClass("disabled",!g.hasExportPages())});var t=function(g){return g.map(function(l){return encodeURIComponent(l)}).join("&")},
m=d("<form/>").attr({id:"export-modal-form",method:"post"}).appendTo("body");d("#exportModalOtherCollapse a.btn-primary").click(function(g){var l=d(this).closest("#exportModalOtherCollapse").find(".export-tree");0<l.length&&(g.preventDefault(),d(this).hasClass("disabled")||(m.empty().attr("action",d(this).attr("href").replace(/pages=.*?(&|$)/g,"")),n(d.jstree.reference(l),m),d(this).closest("#exportModalOtherCollapse").find('input[type="hidden"][name="filter"]').clone().appendTo(m),m.submit()))});
require(["export-tree","export-tree-filter"],function(){d(".export-tree").exportTree()})})}).apply("]]#",$jsontool.serialize([$paths,$l10n,$icons]));

//# sourceMappingURL=exporter.min.js.map
